# 军队单元移动系统移植方案 (修订版)

## 核心修改

### 1. 地形类型集合
- 不使用 isWater 等字段
- 定义地形类型集合 (terrain groups): land, sea, air
- 移动规则：不同类型单位只能在对应集合地形上移动

### 2. 地形数据采用 ECS 架构
- 场景 JSON 中存储地形组件数据
- 运行时组装为 ECS 组件

### 3. 军事单位移动系统
- 单位存储采用 ECS 方式
- 单元核心组件：owner (所属者), moves (移动力)
- 实现编辑器中放置测试单位功能
- 实现游戏中单位移动功能

---

## 实施步骤

### 步骤 1: 扩展场景数据格式
在 SceneData 中添加:
```typescript
// 地形集合定义
terrainGroups: {
  land: string[],      // 可在陆地移动的地形ID
  sea: string[],      // 可在海上移动的地形ID  
  air: string[]      // 空中单位可移动地形
}

// 单位组件数据 (ECS)
units: [
  {
    id: string,
    q: number, r: number,
    owner: string,
    moves: number,
    maxMoves: number
  }
]
```

### 步骤 2: 创建 MovementSystem
- `computeReachableTiles(unit)`: 基于地形集合计算可达范围
- `getMoveCost(from, to, unitType)`: 获取移动成本
- `canMoveTo(unit, hex)`: 检查移动可行性
- `executeMove(unit, hex)`: 执行移动并扣除移动力

### 步骤 3: 扩展 Editor 编辑器
- 添加放置军事单位工具
- 支持选择 owner 和设置初始移动力
- 预览可达范围

### 步骤 4: 集成到游戏系统
- 回合开始时重置单位移动力
- 显示可移动范围高亮
- 点击移动交互

---

## 文件变更

1. **src/core/map/SceneData.ts** - 添加 terrainGroups, units 字段
2. **src/core/systems/MovementSystem.ts** - 新建移动系统
3. **src/editor/systems/EditorTools.ts** - 添加放置单位工具
4. **src/editor/components/ToolButtons.vue** - 添加单位放置按钮
5. **public/data/terrainGroups.json** - 新建地形集合配置