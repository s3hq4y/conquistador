# AI 操作阶段阻止玩家输入

## 问题

玩家点击结束回合后进入 AI 阶段，但玩家依然可以操控单位。

## 解决方案

### 1. 在 gameEventStore 添加 isAITurn 状态
```typescript
const isAITurn = ref(false)

function setAITurn(value: boolean) {
  isAITurn.value = value
}
```

### 2. 在 TurnSystem 中设置/清除状态
- AI 回合开始时: `gameEventStore.setAITurn(true)`
- AI 回合结束时: `gameEventStore.setAITurn(false)`

### 3. 在 InputHandlerSystem 中阻止输入
```typescript
private handleMouseDown(e: MouseEvent): void {
  if (this.gameEventStore.isAITurn) return;  // AI 回合禁止输入
  
  // ... 原有逻辑
}
```

### 4. AI 延迟 1 秒后自动结束回合
```typescript
private triggerAITurn(): void {
  this.isAITurn = true;
  this.gameEventStore.setAITurn(true);
  debug.ui('AI turn started');

  setTimeout(() => {
    debug.ui('AI turn ended');
    this.isAITurn = false;
    this.gameEventStore.setAITurn(false);
    this.endTurn();
  }, 1000);
}
```

## 执行顺序

1. 添加 `isAITurn` 到 `gameEventStore`
2. 修改 `TurnSystem` 设置状态
3. 修改 `InputHandlerSystem` 检查状态